<!DOCTYPE HTML>
<html lang="de-CH">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles/advent2021.css">
    <title>Advent 2021</title>
  </head>
  <body  class="noselect">

  <header>
    <h1>  Advent calendar 2021  for Liam</h1>
  </header>
  <div id="container1" class="container1">
    <p id="box3" class="box" onclick="openDoor('3');"> 3 </p>
    <p id="box7" class="box" onclick="openDoor('7');"> 7 </p>
    <p id="box15" class="box" onclick="openDoor(15);"> 15 </p>
    <p id="box1" class="box" onclick="openDoor('1');"> 1 </p>
    <p id="box8" class="box" onclick="openDoor('8');"> 8 </p>
    <p id="box14" class="box" onclick="openDoor('14');"> 14 </p>
    <p id="box16" class="box" onclick="openDoor('16');"> 16 </p>
    <p id="box21" class="box" onclick="openDoor('21');"> 21 </p>
    <p id="box10" class="box" onclick="openDoor('10');"> 10 </p>
    <p id="box23" class="box" onclick="openDoor('23');"> 23 </p>
    <p id="box9" class="box" onclick="openDoor('9');"> 9 </p>
    <p id="box24" class="box" onclick="openDoor('24');"> 24  </p>
    <p id="box11" class="box" onclick="openDoor('11');"> 11 </p>
    <p id="box4" class="box" onclick="openDoor('4');"> 4 </p>
    <p id="box13" class="box" onclick="openDoor('13');"> 13 </p>
    <p id="box19" class="box" onclick="openDoor('19');"> 19 </p>
    <p id="box17" class="box" onclick="openDoor('17');"> 17 </p>
    <p id="box12" class="box" onclick="openDoor('12');"> 12 </p>
    <p id="box18" class="box" onclick="openDoor('18');"> 18 </p>
    <p id="box20" class="box" onclick="openDoor('20');"> 20 </p>
    <p id="box6" class="box" onclick="openDoor('6');"> 6 </p>
    <p id="box2" class="box" onclick="openDoor('2');"> 2 </p>
    <p id="box22" class="box" onclick="openDoor('22');"> 22 </p>
    <p id="box5" class="box" onclick="openDoor('5');"> 5 </p>
  </div>

  <div id="container2" class="container2">
    <img id="adventPic" class="adventPic" onclick="closePic();" src="media/2021-12-01_advent.jpg" alt="AdventPic">
    <p id="boxPic" class="box" onclick="closePic();">  </p>
  </div>




  <script>
    // Zeitanpassung für Kanada
    const heute = new Date(); // aktuelles Datum und aktuelle Zeit lokal
      var todayCA = heute;
        todayCA = new Date(todayCA - 9*60*60*1000); // time in CA -9h
        console.log("CA Zeit: " + todayCA);
        console.log("CH Zeit: " + heute);

    // Cookies auslesen und in ein Array schreiben, brauche nur
    // die Namen, also 1, 2, usw.
    var arrCookies = new Array;
      var cookieList = (document.cookie) ? document.cookie.split(';') : [];
      var cookieValues = {};
      for (var i = 0, n = cookieList.length; i != n; ++i) {
        var cookie = cookieList[i];
        var f = cookie.indexOf('=');
        if (f >= 0) {
          var cookieName = cookie.substring(0, f);
          var cookieValue = cookie.substring(f + 1);
          arrCookies.push(cookieName); // cookie namen in Array speichern
            if (!cookieValues.hasOwnProperty(cookieName)) {
            cookieValues[cookieName] = cookieValue;
          }
        }
      }

    keepDoorsOpen();// bereits geöffnete Doors anzeigen

    function createCookie(name,value,days) {
    	if (days) {
    		var date = new Date();
    		date.setTime(date.getTime()+(days*24*60*60*1000));
    		var expires = "; expires="+date.toGMTString();
    	}
    	else var expires = "";
    	document.cookie = name+"="+value+expires+"; path=/";
    }

    function openDoor(key) {  // richtiges Tor=grün,
                              // falsches Tor = 0.5s rot
      if (key <= todayCA.getDate()) { // aktueller Tag oder früher

        document.getElementById("box"+key).style.background = "lightgreen";
        // Cookie für offene Türe erstellen, etzte Nummer = Anz. Tage gültig
        createCookie(key,"open",30);// Name, Wert, Dauer in Tagen
        // Bild anzeigen
        document.getElementById("container1").style.visibility = "hidden";
        document.getElementById("container2").style.visibility = "visible";
        // Für Bildname media/2021-12-01 bis 09 anpassen 0 einfügen
          if (key <= 9) {
            key0 = "-0";
            }
            else {
              key0 = "-";
            }
        document.getElementById("adventPic").src ="media/2021-12"+key0+key+"_advent.jpg";
        document.getElementById("boxPic").innerHTML = key;
        document.getElementById("boxPic").style.background = "lightgreen";
        }
        else {
          document.getElementById("box"+key).style.background = "red";
          setTimeout(doorTimer,500);// 500ms warten, dann Farbe wechseln
          }
        function doorTimer()  {
          document.getElementById("box"+key).style.background = "darkblue";
        }
      }

    function keepDoorsOpen() {
      for (var i = 0; i < arrCookies.length; i++) {
        if (!isNaN(arrCookies[i])) {
          document.getElementById("box"+parseInt(arrCookies[i])).style.background = "lightgreen";
        }
      }
    }

    function closePic() {
      document.getElementById("container1").style.visibility = "visible";
      document.getElementById("container2").style.visibility = "hidden";
    }

  </script>
  </body>
</html>
